# 引継ぎ仕様書

## 1. はじめに

このドキュメントは、「Eagle API直接実装ツールの開発」タスクに関する作業内容と、後続の担当者への引き継ぎ事項をまとめたものです。

### 1.1. 背景と目的

本プロジェクトは、AIアシスタントとEagle Appを連携させるMCPサーバーです。これまでは利用シーンを想定した抽象的なツール（例：`folder_search`）のみを提供していました。

今回の開発では、Eagle APIの持つ潜在的な能力を最大限に活用し、より柔軟で低レベルな操作を可能にすることを目的に、以下の作業を実施しました。

1.  **Eagle APIの仕様調査**: APIで提供される全機能（エンドポイント、パラメータ等）を調査し、ドキュメント化しました。
2.  **直接APIツールの実装**: 調査結果に基づき、Eagle APIの各エンドポイントを直接呼び出すための新しいMCPツール群を実装しました。
3.  **関連ドキュメントの整備**: プロジェクトの理解を助けるため、機能構成図などのドキュメントを作成しました。

## 2. 追加・変更された機能

### 2.1. Eagle API直接実装ツール

Eagle APIの各エンドポイントと1対1で対応する、新しいツール群を追加しました。

*   **担当ハンドラー**: `handlers/direct_api.py`
    *   この新しいハンドラーが、すべての直接API呼び出しを処理します。
*   **命名規則**:
    *   ツール名は `api_{category}_{action}` という規則に基づいています。（例: `api_folder_create`）
*   **動作**:
    *   これらのツールは、Eagle APIからのJSONレスポンスを整形せずに、そのままテキストとしてクライアントに返却します。これにより、呼び出し側はAPIからの生の情報を直接利用できます。
*   **ルーティング**:
    *   `main.py` の `call_tool` 関数を更新し、ツール名が `api_` で始まる場合は `DirectApiHandler` に処理を委譲するように変更しました。

## 3. 追加されたドキュメント

今回の開発で、以下のドキュメントをプロジェクトに追加しました。

1.  **`docs/EAGLE_API_SPEC.md`**
    *   **内容**: Eagle APIの仕様調査の結果をまとめたドキュメントです。APIで「できること」と「できないこと」が記載されており、今後の機能拡張やデバッグの際の重要な参照資料となります。

2.  **`FUNCTIONAL_ARCHITECTURE.md`**
    *   **内容**: プロジェクト全体の機能構成と、クライアントからEagle APIまでのデータフローを視覚的に表現した図です。プロジェクトのアーキテクチャを素早く理解するのに役立ちます。

## 4. 後続タスクと推奨事項

今後の開発を円滑に進めるため、以下のタスクを推奨します。

### 4.1. テストの実装

*   **内容**: 新しく追加した `handlers/direct_api.py` に対する単体テストが未実装です。`tests/` ディレクトリに `test_direct_api.py` を作成し、各API呼び出しツールが正しく動作することを確認するテストケースを追加してください。
*   **重要度**: **高**

### 4.2. 設定ファイルの活用

*   **内容**: 現在、`direct_api.py` 内のツール定義はPythonのリストとしてハードコーディングされています。これを `config.template.json` のような外部設定ファイルに切り出すことで、将来Eagle APIの仕様が変更された際に、コードを修正することなくツール定義を更新できるようになります。
*   **重要度**: 中

### 4.3. 抽象化ツールの機能拡充

*   **内容**: `EAGLE_API_SPEC.md` の調査で、既存の抽象化ハンドラー（`ItemHandler` など）にはまだ実装されていないAPI機能（例: `item/addBookmark`）がいくつか見つかりました。これらの便利な機能を、既存のハンドラーに組み込んでください。
*   **重要度**: 中

### 4.4. エラーハンドリングの強化

*   **内容**: `DirectApiHandler` は現在、Eagle APIから返されたエラーをそのままラップして返します。APIが返すエラーコードやメッセージを解釈し、より具体的で分かりやすいエラーメッセージを生成するよう、エラーハンドリング処理を改善することを検討してください。
*   **重要度**: 低

## 5. 開発環境と実行

開発環境のセットアップとサーバーの実行方法は、`README.md` に記載されている通りです。

*   **依存関係のインストール**: `uv sync`
*   **開発サーバーの起動**: `uv run main.py` または `run.bat`
